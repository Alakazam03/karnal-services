---
// src/components/LeadForm.astro â€” Lead form that opens WhatsApp with pre-filled message (client-side)
interface Props {
  serviceLabel: string;
  serviceSlug: string;
}
const { serviceLabel, serviceSlug } = Astro.props;
---

<div class="rounded-xl border border-stone-200 bg-white p-6 shadow-sm" id="lead-form">
  <h2 class="mb-4 text-lg font-semibold text-stone-900">Get in touch via WhatsApp</h2>
  <p class="mb-4 text-sm text-stone-600">
    Fill the form and we'll open WhatsApp with a pre-filled message. Send when you're ready.
  </p>
  <form id="whatsapp-lead-form" class="space-y-4">
    <input type="hidden" name="service" value={serviceLabel} data-service-slug={serviceSlug} />
    <div>
      <label for="lead-name" class="mb-1 block text-sm font-medium text-stone-700">Name</label>
      <input
        id="lead-name"
        name="name"
        type="text"
        required
        class="w-full rounded-lg border border-stone-300 px-3 py-2 text-stone-900 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
        placeholder="Your name"
      />
    </div>
    <div>
      <label for="lead-phone" class="mb-1 block text-sm font-medium text-stone-700">Phone</label>
      <input
        id="lead-phone"
        name="phone"
        type="tel"
        required
        class="w-full rounded-lg border border-stone-300 px-3 py-2 text-stone-900 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
        placeholder="10-digit number"
      />
    </div>
    <div>
      <label for="lead-message" class="mb-1 block text-sm font-medium text-stone-700">Message (optional)</label>
      <textarea
        id="lead-message"
        name="message"
        rows={3}
        class="w-full rounded-lg border border-stone-300 px-3 py-2 text-stone-900 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
        placeholder="e.g. Need quote for 1200 sq.ft"
      />
    </div>
    <button
      type="submit"
      class="w-full rounded-lg bg-emerald-600 px-4 py-3 font-medium text-white hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
    >
      Send via WhatsApp
    </button>
  </form>
</div>

<script define:vars={{ serviceLabel, serviceSlug }}>
  document.getElementById('whatsapp-lead-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target as HTMLFormElement;
    const name = (form.querySelector('[name="name"]') as HTMLInputElement).value.trim();
    const phone = (form.querySelector('[name="phone"]') as HTMLInputElement).value.trim();
    const service = (form.querySelector('[name="service"]') as HTMLInputElement).value.trim();
    const message = (form.querySelector('[name="message"]') as HTMLTextAreaElement).value.trim();
    if (window.gtag) {
      window.gtag('event', 'generate_lead', { method: 'whatsapp', service_slug: serviceSlug, service_label: serviceLabel });
    }
    const text = encodeURIComponent(
      ['Hi, I\'m ' + name + '.', 'Phone: ' + phone + '.', 'Interested in: ' + service + '.', message].filter(Boolean).join(' ')
    );
    const num = (typeof import.meta.env.PUBLIC_WHATSAPP_NUMBER === 'string' && import.meta.env.PUBLIC_WHATSAPP_NUMBER)
      ? import.meta.env.PUBLIC_WHATSAPP_NUMBER
      : '919876543210';
    window.open('https://wa.me/' + num + '?text=' + text, '_blank', 'noopener');
  });
</script>
