---
// src/pages/service/[slug].astro — Programmatic niche page: hero, intro, calculator, FAQ, rate card CTA, related services
import BaseLayout from '../../layouts/BaseLayout.astro';
import FAQ from '../../components/FAQ.astro';
import LeadForm from '../../components/LeadForm.astro';
import ConstructionCostCalculator from '../../react/ConstructionCostCalculator';
import { getServiceBySlug, getAllServices } from '../../lib/services';

export function getStaticPaths() {
  return getAllServices().map((s) => ({ params: { slug: s.slug }, props: { service: s } }));
}

interface Props {
  service: import('../../lib/services').ServiceNiche;
}
const { service } = Astro.props;
const baseUrl = Astro.url.origin;
const canonical = `/service/${service.slug}`;
const ogImageUrl = `${baseUrl}/api/og.png?label=${encodeURIComponent(service.ogLabel)}`;
const relatedServices = getAllServices().filter((s) => s.slug !== service.slug);
---

<BaseLayout
  title={service.title}
  description={service.description}
  canonical={canonical}
  ogImage={ogImageUrl}
  ogLabel={service.ogLabel}
>
<div class="mx-auto max-w-3xl px-4 py-10">
  <article>
    <h1 class="mb-4 text-3xl font-bold text-stone-900">{service.heroHeadline}</h1>
    <p class="lead mb-6 text-lg text-stone-600">{service.heroLead}</p>

    <div class="mb-8 space-y-4 text-stone-600">
      {service.introText.map((p) => (
        <p>{p}</p>
      ))}
    </div>

    {service.calculatorType === 'construction' && (
      <div class="mb-10">
        <ConstructionCostCalculator client:visible />
      </div>
    )}

    <div class="mb-10">
      <FAQ faqs={service.faqs} />
    </div>

    <section class="mb-10 rounded-xl border border-stone-200 bg-stone-100 p-6">
      <h2 class="mb-4 text-xl font-semibold text-stone-900">{service.rateCardHeading}</h2>
      <p class="mb-4 text-sm text-stone-600">{service.rateCardBody}</p>
      <a
        href="/api/rate-card.pdf"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-block rounded-lg bg-emerald-600 px-4 py-2 font-medium text-white no-underline hover:bg-emerald-700"
      >
        {service.rateCardButton}
      </a>
    </section>

    <section class="mb-10">
      <h2 class="mb-4 text-xl font-semibold text-stone-900">Karnal mein aur services</h2>
      <p class="mb-4 text-sm text-stone-600">
        Civil, interior, solar, aur pest control—sab ek jagah.
      </p>
      <ul class="grid gap-4 sm:grid-cols-2">
        {relatedServices.map((s) => (
          <li>
            <a
              href={`/service/${s.slug}`}
              class="block rounded-xl border border-stone-200 bg-white p-4 no-underline shadow-sm transition hover:border-emerald-300 hover:shadow"
            >
              <span class="font-medium text-stone-900">{s.cardTitle}</span>
              <span class="mt-1 block text-sm text-emerald-600">→ {s.cardLinkText}</span>
            </a>
          </li>
        ))}
      </ul>
    </section>

    <div class="mb-10">
      <LeadForm serviceLabel={service.ogLabel} serviceSlug={service.slug} />
    </div>
  </article>
</div>

{/* JSON-LD: LocalBusiness + FAQPage */}
<Fragment set:html={`
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "LocalBusiness",
      "name": "${service.ogLabel}",
      "description": ${JSON.stringify(service.description)},
      "areaServed": { "@type": "City", "name": "Karnal", "containedInPlace": { "@type": "State", "name": "Haryana" } },
      "url": "${baseUrl}${canonical}",
      "address": { "@type": "PostalAddress", "addressLocality": "Karnal", "addressRegion": "Haryana", "addressCountry": "IN" }
    },
    {
      "@type": "FAQPage",
      "mainEntity": ${JSON.stringify(
        service.faqs.map((f) => ({
          '@type': 'Question',
          name: f.question,
          acceptedAnswer: { '@type': 'Answer', text: f.answer }
        }))
      )}
    }
  ]
}
</script>
`} />
</BaseLayout>
